<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>caching</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css" />
  <style>
    p,
    h4 {
      padding: 0 40px;
    }

    p {
      text-align: justify;
    }

    .content {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgb(90, 122, 134);
    }

    .container {
      width: 1140px;
      background: white;
    }
  </style>
</head>

<body>
  <div class="content">
    <div class="container">
      <h4>Кэширование.</h4>
      <p>
        Кэширование нужно, когда у нас есть источник данных и он выдаёт их не совсем подходящим способ (слишком долго,
        много тратит ресурсов, ограничивает нас по количеству данных). Кэширование - первый раз данные получаются нами
        из основного источника (бд с сервера из другой страны) и складываем их в удобную для нас систему хранения, но
        уже у себя на сервере или в оперативной памяти. <b>Кэш нужно применять в самых крайних случаях</b>, когда это
        сильно
        необходимо, так как оно очень усложняет отладку приложения. Так как при отладке проблему будет трудно обнаружить
        с чем она связана (с данными из кэша или реального источника). Ещё одна проблема - обнаружение уже не
        актуальных (устаревших) данных.
      </p>
      <p>
        Система кэширования yii фрэймворка очень удобная и мощная и она помогает кэшировать данные в различных
        хранилищах
        и при этом одним и тем же способом (универсальный интерфес). В компонентах мы обнаружим:<br>
        'cache' => ['class' => 'yii\caching\FileCache',]<br>
        Также как с БД, мы можем настроить несколько компонентов для работы с кэшем. Один будет работать с файлами, а
        второй с БД 'cacheDb' => ['class' => 'yii\caching\DbCache',]; Система не ограничивается этими вариантами
        кэширования. Использовать их будем в контроллерах также как и работали с БД: \Yii::$app->cache; <br>
      </p>
      <p>
        Общий случай кэширования данных. Допустим у нас есть некий источник, который мы представим функцией data(),
        который выдаёт данные не удовлетворяющим нас способом (слишком долго). Сначала проверим не захешированны ли
        у нас уже эти данные: $key = 'key' - придумали уникальный идентификатор; if(\Yii::$app->cache->exists($key))
        {$data = \Yii::$app->cache->get($key)} else {$data = data() - иначе запросим данные; \Yii::$app->cache
        ->set($key, $data)};<br>
        Но чаще применяют более простой вариант: $key = 'key'; if(!($data = \Yii::$app->cache->get($key)) {$data =
        data();
        \Yii::$app->cache->set($key, $data)}. Важно понимать, что данные в системе хэширования всегда сохраняются в
        строковом виде (процесс сериализации), а аозвращаются в том виде, в котором пришли. ->add($key, $data) -
        добавит данные, если ключа не было такого, а ->set($key, $data) на это не смотрит; ->delete($key) - удалит
        любое значение в кэше ->flush() - удаление/очистка кэша; ->getOrset(); ->multiAdd(), ->multuGet(), multySet().
        Очень важный момент при работе с любым кэширование - определение и удаление ненужных устраевших данных.
        \Yii::$app->cache->set($key, $data, 3600 - в третьем параметре указываем когда данные станут не актуальными:
        время-
        по умолчанию 60сек.). Но иногда важно данные обновить сразу же как только они изменятся (имя пользователя). Для
        таких случаев есть 4-ый пункт: зависимости (условия, которые будут проверяется каждый раз при получении данных):
        \Yii::$app->cache->set($key, $data, 3600, new FileDependency(['filename' => $fileName]));<br>
        new FileDependency(['filename' => $fileName]) - вид зависимости при чтении данных из файла и когда у нас $data =
        file_get_contents($fileName). Будет проверятся дата кэшированного файла с изменёнными данными. Если он моложе
        исходника, то всё ок - с ним можно работать, если нет, то ключ уничтожается и исходный файл снова читается и
        кэшируется<br>
        <img src="/img/cache-file.jpg" alt="cache-file"><br>
        Также применяются зависимости DbDependency, DbQueryDependency, ChainedDependency, ExpressionDependency,
        TagDependency.
        Название ключа также можно представить в виде массива, так как он всё равно будет сериализованн. $key = ['key',
        'user']<br>  
        Специфичные виды кэширования. Кэширование фрагментов, кэширование страниц, http кэширование, кэширование
        запросов в БД. Всё это также работает с помощью команд get, set, delete. См. справку.
      </p>
    </div>
  </div>
</body>

</html>